# HistLink データ品質レポート

**作成日**: 2025-11-14
**データベース**: PostgreSQL (histlink)

---

## データ統計サマリー

### 用語（Terms）

| 指標 | 値 |
|------|-----|
| **総用語数** | 200語 |
| **日本史用語** | 100語（ID: 1-100） |
| **西洋史用語** | 100語（ID: 101-200） |

#### 時代別分布

| 時代 | 用語数 |
|------|--------|
| 古代 | 30語 (15%) |
| 中世 | 40語 (20%) |
| 近世 | 45語 (22.5%) |
| 近代 | 50語 (25%) |
| 現代 | 35語 (17.5%) |

### リレーション（Relations）

| 指標 | 値 |
|------|-----|
| **総リレーション数** | 675件 |
| **日本史内リレーション** | 389件 |
| **西洋史内リレーション** | 約270件 |
| **日本西洋史接点** | 16件 |

#### リレーションタイプ別分布

| タイプ | 件数 | 割合 |
|--------|------|------|
| 因果 | 220件 | 32.6% |
| 契機 | 216件 | 32.0% |
| 同時代 | 93件 | 13.8% |
| 対立 | 53件 | 7.9% |
| 文化 | 45件 | 6.7% |
| 政策 | 43件 | 6.4% |
| 外交 | 5件 | 0.7% |

### グラフ構造品質

| 指標 | 値 |
|------|-----|
| **平均次数（degree）** | 6.70 |
| **最小次数** | 2 ✅ |
| **最大次数** | 18 |
| **Dead points（degree < 2）** | **0件** ✅ |
| **孤立ノード** | 0件 ✅ |

---

## データ品質評価

### ✅ 合格項目

1. **ノード最小次数**: すべての用語がdegree ≥ 2を満たす
2. **孤立ノード**: 0件（完全連結グラフ）
3. **自己ループ**: なし（データベース制約で保証）
4. **重複リレーション**: なし（UNIQUE制約で保証）
5. **時代別バランス**: 古代〜現代まで適切に分布

### 📊 特徴

1. **日本西洋史接点の隘路設計**
   - 接点リレーション: 16件
   - 近世（江戸）: 3件
   - 近代: 1件
   - 現代: 12件
   - → 意図的に接点を限定し、ゲーム性を向上

2. **リレーションタイプの多様性**
   - 因果・契機が全体の64.6%（歴史の流れ重視）
   - 対立・外交関係も適切に表現
   - 文化・思想の継承も捕捉

3. **ハブノード（高次数ノード）**
   - 最大次数18: 橋渡し的な重要用語
   - 平均次数6.7: 適度な接続密度

---

## マイグレーション履歴

### 001_create_tables.sql
- テーブル構造作成（terms, relations）
- 制約設定（UNIQUE, CHECK）

### 002_seed_data.sql
- 日本史100語 + 日本史内リレーション389件

### 003_western_history_data.sql
- 西洋史100語 + 西洋史内リレーション約225件
- 日本西洋史接点リレーション16件
- ⚠️ 重複エラー（341行目）により一部未挿入

### 004_fix_dead_points.sql
- 003の重複エラーで挿入されなかった46件を追加
- Dead points: 20件 → 2件に改善

### 005_complete_dead_points.sql
- 最後の2件（リンカーン、サラエボ事件）を解消
- Dead points: 2件 → **0件** ✅

---

## データ整合性検証

### 用語の重複回避

以下の用語は日本史・西洋史両方に存在するため、識別子を追加：

| 基本名 | 日本史 ID | 西洋史 ID | 西洋史用語名 |
|--------|-----------|-----------|--------------|
| 日露戦争 | 79 | 182 | 日露戦争（西洋視点） |
| 世界恐慌 | 88 | 188 | 世界恐慌（国際経済） |
| 第一次世界大戦 | 82 | 183 | 第一次世界大戦（西洋史） |
| 第二次世界大戦 | 92 | 192 | 第二次世界大戦（西洋史） |
| 真珠湾攻撃 | 94 | 193 | 真珠湾攻撃（対米開戦） |

---

## ゲーム設計への影響

### 1. 単一史専用モード

- **日本史ルート**: ID 1-100のみ使用（389リレーション）
- **西洋史ルート**: ID 101-200のみ使用（約270リレーション）
- それぞれ独立してプレイ可能

### 2. クロスオーバーモード

- 日本史 ⇔ 西洋史の移動が16箇所の接点で可能
- 近世（江戸）: 限定的（アヘン戦争、産業革命、啓蒙思想経由）
- 現代: 多数の接点（世界大戦、冷戦など）
- **隘路効果**: 時代によっては移動困難 → ゲーム性向上

### 3. グラフ探索の難易度

- 平均次数6.7: 適度な選択肢
- 最小次数2: 行き止まりなし
- 最大次数18: ハブノードで選択肢が豊富

---

## 改善履歴

### ファイル作成プロセスの改善

**問題**: ファイル名・ディレクトリ構造をユーザーに相談せずに作成
**対応**:
1. 失敗記録作成: `.serena/failures/2025-11-14_file-naming-without-consultation.md`
2. プロジェクトCLAUDE.md作成: ファイル作成前の確認ルールを明記
3. 再発防止策の文書化

### データファイル統合

**変更前**:
- `data/terms_100.md` (日本史のみ)
- `data/western_history/西洋史100語リスト.md`
- `data/relations_300.md` (日本史リレーション詳細)
- `data/western_history/西洋史リレーション300.md`
- `data/western_history/日本西洋史接点リレーション.md`

**変更後**:
- `data/terms.md` (統合版200語)
- `data/relations.md` (全リレーション統合、統計とSQL)
- `data/data_quality_report.md` (品質レポート)

---

## 次のステップ

### 推奨される追加機能

1. **リレーションの双方向性チェック**
   - 一部の歴史的関係は双方向が自然
   - 例: 対立関係、同時代関係

2. **時代間リレーションの分析**
   - 時代を超えたリレーションの可視化
   - 長期的影響の追跡

3. **タグベースの検索最適化**
   - tags配列を活用したクエリ性能向上
   - インデックス追加検討

4. **ゲームバランステスト**
   - ランダムウォークシミュレーション
   - 最短経路分析（日本史起点 → 西洋史ゴールなど）

---

## まとめ

✅ **データ品質**: 優良
✅ **グラフ構造**: 健全（dead points 0、孤立ノード 0）
✅ **ゲーム設計**: 隘路設計により適度な難易度を実現
✅ **データ整合性**: 重複なし、制約違反なし

**総合評価**: 本番環境への投入準備完了 🎉
