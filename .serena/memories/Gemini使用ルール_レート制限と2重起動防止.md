# Gemini使用ルール - レート制限と2重起動防止

## レート制限

**Geminiの無料枠制限:**
- **2回/分**（1分間に2リクエストまで）
- 超過すると429エラー（RESOURCE_EXHAUSTED）
- リトライ待機時間：約20-30秒

## 絶対に守るべきルール

### 1. 2重起動を絶対に避ける

**問題が発生した事例（2025-11-13）:**
- 2つのGeminiプロセスを同時に起動
- それぞれがリトライを繰り返す
- レート制限を食いつぶして両方失敗

**対策:**
```
❌ 悪い例:
- Gemini呼び出し1を開始
- 結果を待たずにGemini呼び出し2を開始
- 両方がレート制限に引っかかる

✅ 良い例:
- Gemini呼び出しの前にバックグラウンドプロセスを確認
- 既に実行中のGeminiがあれば待つ
- 1つのGeminiが完了してから次を実行
```

### 2. Gemini呼び出し前の確認

**チェック項目:**
1. `Bash`ツールでバックグラウンド実行されているGeminiプロセスはないか？
2. system-reminderで`gemini`関連のBackground Bashが報告されていないか？
3. 直近1分以内にGeminiを呼び出していないか？

### 3. 連続呼び出しを避ける

**間隔を空ける:**
- 最低30秒以上の間隔を空ける
- 可能なら1分以上待つ
- 急ぎでない場合は、複数の質問を1つにまとめる

### 4. エラー時の対処

**503エラー（サーバーオーバーロード）の場合:**
- すぐにリトライしない
- 1-2分待ってから再試行

**429エラー（レート制限）の場合:**
- エラーメッセージの`retryDelay`を確認
- 指定された時間（通常20-30秒）待つ
- 無理に再試行しない

## Gemini起動コマンド

```bash
gemini -p "質問内容"
```

## 実装例

### Gemini呼び出し前のチェック（擬似コード）

```
1. system-reminderを確認
2. "Background Bash" + "gemini" が含まれているか？
3. YES → 「既にGeminiが実行中です。完了を待ってから再試行してください」
4. NO → Gemini呼び出しを実行
```

## 発生した問題の詳細

**日時:** 2025-11-13 15:25-15:36

**状況:**
- 095bb3: 最初のGemini呼び出し（Notion MCP削除方法について）
- a99e08: 2つ目のGemini呼び出し（Notion MCP実装方法について）

**結果:**
- 両方とも503エラー→429エラーで失敗
- レート制限を完全に消費
- 約10分間Geminiが使用不可

**教訓:**
**絶対に2つのGeminiプロセスを同時に起動しない**
